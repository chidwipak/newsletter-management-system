<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newsletter Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-blue-600">NewsletterHub</h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/login" class="text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">Login</a>
                    <a href="/register" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">Sign Up</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section - Fixed Layout -->
    <div class="relative bg-white overflow-hidden">
        <div class="max-w-7xl mx-auto">
            <div class="relative z-10 pb-8 bg-white sm:pb-16 md:pb-20 lg:max-w-2xl lg:w-full lg:pb-28 xl:pb-32">
                <!-- SVG Background Shape -->
                <svg class="hidden lg:block absolute right-0 inset-y-0 h-full w-48 text-white transform translate-x-1/2" fill="currentColor" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
                    <polygon points="50,0 100,0 50,100 0,100" />
                </svg>

                <main class="mt-10 mx-auto max-w-7xl px-4 sm:mt-12 sm:px-6 md:mt-16 lg:mt-20 lg:px-8 xl:mt-28">
                    <div class="sm:text-center lg:text-left">
                        <h1 class="text-4xl tracking-tight font-extrabold text-gray-900 sm:text-5xl md:text-6xl">
                            <span class="block xl:inline">Your Digital</span>
                            <span class="block text-blue-600 xl:inline">Magazine Hub</span>
                        </h1>
                        <p class="mt-3 text-base text-gray-500 sm:mt-5 sm:text-lg sm:max-w-xl sm:mx-auto md:mt-5 md:text-xl lg:mx-0">
                            Discover engaging articles, manage your subscriptions, and stay updated with the latest content from our expert editors and writers.
                        </p>
                        <div class="mt-5 sm:mt-8 sm:flex sm:justify-center lg:justify-start">
                            <div class="rounded-md shadow">
                                <a href="/register" class="w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 md:py-4 md:text-lg md:px-10">
                                    Get Started
                                </a>
                            </div>
                            <div class="mt-3 sm:mt-0 sm:ml-3">
                                <a href="#preview" class="w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 md:py-4 md:text-lg md:px-10">
                                    Browse Content
                                </a>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <!-- Fixed Hero Image Container -->
        <div class="lg:absolute lg:inset-y-0 lg:right-0 lg:w-1/2">
            <div class="h-56 w-full sm:h-72 md:h-96 lg:w-full lg:h-full relative overflow-hidden">
                <img class="absolute inset-0 w-full h-full object-cover object-center" 
                     src="https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=800&h=600&fit=crop&crop=center" 
                     alt="Newsletter and magazine management"
                     loading="lazy">
                <!-- Overlay for better text contrast if needed -->
                <div class="absolute inset-0 bg-gradient-to-r from-white via-transparent to-transparent lg:hidden"></div>
            </div>
        </div>
    </div>

    <!-- Features Section -->
    <div class="py-12 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="lg:text-center">
                <h2 class="text-base text-blue-600 font-semibold tracking-wide uppercase">Features</h2>
                <p class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-gray-900 sm:text-4xl">
                    Everything you need to manage content
                </p>
            </div>

            <div class="mt-10">
                <div class="space-y-10 md:space-y-0 md:grid md:grid-cols-3 md:gap-x-8 md:gap-y-10">
                    <!-- Feature 1 -->
                    <div class="relative">
                        <div class="absolute flex items-center justify-center h-12 w-12 rounded-md bg-blue-500 text-white">
                            <i data-lucide="users" class="h-6 w-6"></i>
                        </div>
                        <p class="ml-16 text-lg leading-6 font-medium text-gray-900">Role-Based Access</p>
                        <p class="mt-2 ml-16 text-base text-gray-500">
                            Separate dashboards for admins, editors, and subscribers with appropriate permissions.
                        </p>
                    </div>

                    <!-- Feature 2 -->
                    <div class="relative">
                        <div class="absolute flex items-center justify-center h-12 w-12 rounded-md bg-blue-500 text-white">
                            <i data-lucide="file-text" class="h-6 w-6"></i>
                        </div>
                        <p class="ml-16 text-lg leading-6 font-medium text-gray-900">Content Management</p>
                        <p class="mt-2 ml-16 text-base text-gray-500">
                            Create, edit, and publish articles and magazine issues with rich content support.
                        </p>
                    </div>

                    <!-- Feature 3 -->
                    <div class="relative">
                        <div class="absolute flex items-center justify-center h-12 w-12 rounded-md bg-blue-500 text-white">
                            <i data-lucide="star" class="h-6 w-6"></i>
                        </div>
                        <p class="ml-16 text-lg leading-6 font-medium text-gray-900">Feedback System</p>
                        <p class="mt-2 ml-16 text-base text-gray-500">
                            Readers can rate and comment on articles to provide valuable feedback.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Preview Section -->
    <div id="preview" class="py-12 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900">Latest Content</h2>
                <p class="mt-4 text-lg text-gray-600">Discover our most recent articles and magazine issues</p>
            </div>

            <!-- Loading State -->
            <div id="loading" class="text-center mt-8">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                <p class="mt-2 text-gray-600">Loading content...</p>
            </div>

            <!-- Content Container -->
            <div id="content-container" class="mt-12 hidden">
                <!-- Recent Articles -->
                <div class="mb-12">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">Recent Articles</h3>
                    <div id="articles-grid" class="grid gap-6 lg:grid-cols-3">
                        <!-- Articles will be loaded here -->
                    </div>
                </div>

                <!-- Recent Issues -->
                <div class="mb-12">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">Magazine Issues</h3>
                    <div id="issues-grid" class="grid gap-6 lg:grid-cols-2">
                        <!-- Issues will be loaded here -->
                    </div>
                </div>

                <!-- Top Rated -->
                <div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">Top Rated Articles</h3>
                    <div id="top-rated-list" class="space-y-4">
                        <!-- Top rated articles will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CTA Section -->
    <div class="bg-blue-600">
        <div class="max-w-2xl mx-auto text-center py-16 px-4 sm:py-20 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-extrabold text-white sm:text-4xl">
                <span class="block">Ready to get started?</span>
                <span class="block">Join our community today.</span>
            </h2>
            <p class="mt-4 text-lg leading-6 text-blue-200">
                Sign up now to access exclusive content and manage your reading experience.
            </p>
            <a href="/register" class="mt-8 w-full inline-flex items-center justify-center px-5 py-3 border border-transparent text-base font-medium rounded-md text-blue-600 bg-white hover:bg-blue-50 sm:w-auto">
                Sign up for free
            </a>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h3 class="text-lg font-semibold text-gray-900">NewsletterHub</h3>
                <p class="mt-2 text-gray-600">Your digital magazine management solution</p>
                <div class="mt-4 text-sm text-gray-500">
                    <p>&copy; 2025 Newsletter Management System. Built for academic demonstration.</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Load preview content with better error handling
        async function loadPreviewContent() {
            try {
                console.log('Loading preview content...');
                const response = await fetch('/api/preview');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Preview data loaded:', data);

                // Hide loading, show content
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('content-container').classList.remove('hidden');

                // Render content
                renderArticles(data.articles || []);
                renderIssues(data.issues || []);
                renderTopRated(data.topRated || []);

            } catch (error) {
                console.error('Error loading preview content:', error);
                const loadingEl = document.getElementById('loading');
                loadingEl.innerHTML = '<p class="text-red-600">Failed to load content. Please try refreshing the page.</p>';
            }
        }

        function renderArticles(articles) {
            const container = document.getElementById('articles-grid');
            if (!articles.length) {
                container.innerHTML = '<p class="text-gray-500 col-span-full text-center">No articles available</p>';
                return;
            }

            container.innerHTML = articles.map(article => `
                <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                    <img src="${article.featured_image_url || 'https://images.unsplash.com/photo-1586953208448-b95a79798f07?w=400&h=200'}" 
                         alt="${article.title}" class="w-full h-48 object-cover">
                    <div class="p-6">
                        <h4 class="text-lg font-semibold text-gray-900 mb-2 line-clamp-2">${article.title}</h4>
                        <p class="text-gray-600 text-sm mb-3 line-clamp-3">${article.summary || 'No summary available'}</p>
                        <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                            <span>By ${article.author_name}</span>
                            ${article.average_rating ? `<span class="flex items-center"><i data-lucide="star" class="h-4 w-4 text-yellow-400 mr-1"></i>${parseFloat(article.average_rating).toFixed(1)}</span>` : ''}
                        </div>
                        <div class="mt-4">
                            <a href="/login" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                Login to read full article →
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function renderIssues(issues) {
            const container = document.getElementById('issues-grid');
            if (!issues.length) {
                container.innerHTML = '<p class="text-gray-500 col-span-full text-center">No issues available</p>';
                return;
            }

            container.innerHTML = issues.map(issue => `
                <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                    <img src="${issue.cover_image_url || 'https://images.unsplash.com/photo-1504711434969-e33886168f5c?w=400&h=300'}" 
                         alt="${issue.title}" class="w-full h-64 object-cover">
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-blue-600">Issue #${issue.issue_number}</span>
                            <span class="text-sm text-gray-500">${new Date(issue.publication_date).toLocaleDateString()}</span>
                        </div>
                        <h4 class="text-xl font-semibold text-gray-900 mb-2">${issue.title}</h4>
                        <p class="text-gray-600 mb-4 line-clamp-3">${issue.description || 'No description available'}</p>
                        <a href="/login" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                            Login to read issue →
                        </a>
                    </div>
                </div>
            `).join('');
        }

        function renderTopRated(topRated) {
            const container = document.getElementById('top-rated-list');
            if (!topRated.length) {
                container.innerHTML = '<p class="text-gray-500 text-center">No rated articles available</p>';
                return;
            }

            container.innerHTML = topRated.map((article, index) => `
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <span class="inline-flex items-center justify-center h-8 w-8 rounded-full bg-blue-100 text-blue-600 font-semibold">
                                ${index + 1}
                            </span>
                        </div>
                        <div class="ml-4 flex-1">
                            <h4 class="text-lg font-medium text-gray-900">${article.title}</h4>
                            <div class="flex items-center mt-1">
                                <div class="flex items-center">
                                    <i data-lucide="star" class="h-4 w-4 text-yellow-400 mr-1"></i>
                                    <span class="text-sm text-gray-600">${parseFloat(article.average_rating).toFixed(1)} (${article.feedback_count} reviews)</span>
                                </div>
                            </div>
                        </div>
                        <div class="ml-4">
                            <a href="/login" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                Read →
                            </a>
                        </div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // Load content when page loads
        document.addEventListener('DOMContentLoaded', loadPreviewContent);
    </script>

    <style>
        /* Add line-clamp utility for text truncation */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</body>
</html>
